# Autohide Module Specific Rules

## Mouse Tracking
- Use Hyprland IPC only (`m_ipc.getSocket1Reply("cursorpos")`)
- Two-consecutive-events requirement for show trigger
- Per-monitor mouse position tracking
- Trace-level logging for mouse position (avoid spam)

## State Management
- Use state machine design (no multiple boolean flags)
- `enum class WaybarState` with `VISIBLE`, `HIDDEN`, `PENDING_VISIBLE`, `PENDING_HIDDEN`
- Only one state can be true at any time

## Timing & Delays
- Minimum 10ms delays to prevent race conditions
- `delay_show` and `delay_hide` configurable
- Timer only starts when entering appropriate state

## Workspace Integration
- Register for `"workspacev2"` and `"focusedmonv2"` events
- Force waybar visible on workspace changes
- Use `waybar::modules::hyprland::modulesReady = true`

## Configuration Options
```json
"autohide": {
  "threshold-hidden-y": 1,      // Mouse Y â‰¤ this shows waybar
  "threshold-visible-y": 50,    // Mouse Y > this hides waybar
  "delay-show": 0,              // Show delay in ms
  "delay-hide": 1000,           // Hide delay in ms
  "check-interval": 100         // Mouse check interval in ms
}
```

## Thread Safety
- Use `std::atomic<WaybarState>` for state
- GTK operations via `dp.emit()` on main thread
- Background thread for mouse tracking only
- Proper cleanup in destructor

## Resource Management
- Minimal memory usage (~180 bytes per module instance)
- Single background thread per module
- Efficient IPC calls (no external processes)
- Clean state transitions
